---
interface PageMeta {
  data: any[];
  start: number;
  end: number;
  total: number;
  currentPage: number;
  size: number;
  lastPage: number;
  url: {
    current: string;
    prev?: string | null | undefined;
    next?: string | null | undefined;
    first?: string | null | undefined;
    last?: string | null | undefined;
  };
}

interface Props {
  page: PageMeta;
  window?: number;
  class?: string;
}

const { page, window: win = 2, class: className } = Astro.props as Props;

function hrefFor(n: number): string {
  const cur = page.url.current;
  const base = cur.replace(/\/(\d+)(\/)$/, '/');
  if (n <= 1) return base;

  return `${base.replace(/\/?$/, '/')}${n}/`;
}

function uniq<T>(arr: T[]): T[] {
  return [...new Set(arr)];
}

function computePages(curr: number, last: number, win: number): Array<number | '…'> {
  const pages: Array<number | '…'> = [];
  const start = Math.max(1, curr - win);
  const end = Math.min(last, curr + win);
  const base = [1, ...Array.from({ length: end - start + 1 }, (_, i) => start + i), last];
  const sorted = uniq(base).sort((a, b) => Number(a) - Number(b));
  for (let i = 0; i < sorted.length; i++) {
    const n = sorted[i]!;
    pages.push(n as number);
    const next = sorted[i + 1];
    if (next !== undefined && next - n > 1) pages.push('…');
  }
  return pages;
}

const items = computePages(page.currentPage, page.lastPage, win);
const sectionClass = ['mt-8 flex items-center justify-center mx-auto', className ?? '']
  .filter(Boolean)
  .join(' ');
---

{
  page.lastPage > 1 && (
    <section class={sectionClass}>
      <nav aria-label="Pagination" class="join">
        {page.url.first ? (
          <a href={page.url.first} class="join-item btn btn-sm" aria-label="First page">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none">
              <path
                d="M11.5 18C11.5 18 5.50001 13.5811 5.5 12C5.49999 10.4188 11.5 6 11.5 6"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
              <path
                d="M18.5 18C18.5 18 12.5 13.5811 12.5 12C12.5 10.4188 18.5 6 18.5 6"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </svg>
          </a>
        ) : (
          <span class="join-item btn btn-sm btn-disabled" aria-label="First page">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none">
              <path
                d="M11.5 18C11.5 18 5.50001 13.5811 5.5 12C5.49999 10.4188 11.5 6 11.5 6"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
              <path
                d="M18.5 18C18.5 18 12.5 13.5811 12.5 12C12.5 10.4188 18.5 6 18.5 6"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </svg>
          </span>
        )}

        {page.url.prev ? (
          <a href={page.url.prev} class="join-item btn btn-sm">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none">
              <path
                d="M15 6C15 6 9.00001 10.4189 9 12C8.99999 13.5812 15 18 15 18"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </svg>
            <span class="hidden lg:block">Previous</span>
          </a>
        ) : (
          <span class="join-item btn btn-sm btn-disabled">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none">
              <path
                d="M15 6C15 6 9.00001 10.4189 9 12C8.99999 13.5812 15 18 15 18"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </svg>
            <span class="hidden lg:block">Previous</span>
          </span>
        )}

        {items.map((it) =>
          it === '…' ? (
            <span class="join-item btn btn-sm btn-disabled">…</span>
          ) : (
            <a
              href={hrefFor(it as number)}
              class={`join-item btn btn-sm ${it === page.currentPage ? 'btn-active pointer-events-none' : ''}`.trim()}
              aria-current={it === page.currentPage ? 'page' : undefined}
            >
              {it}
            </a>
          ),
        )}

        {page.url.next ? (
          <a href={page.url.next} class="join-item btn btn-sm">
            <span class="hidden lg:block">Next</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none">
              <path
                d="M9.00005 6C9.00005 6 15 10.4189 15 12C15 13.5812 9 18 9 18"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </svg>
          </a>
        ) : (
          <span class="join-item btn btn-sm btn-disabled">
            <span class="hidden lg:block">Next</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none">
              <path
                d="M9.00005 6C9.00005 6 15 10.4189 15 12C15 13.5812 9 18 9 18"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </svg>
          </span>
        )}

        {page.url.last ? (
          <a href={page.url.last} class="join-item btn btn-sm" aria-label="Last page">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none">
              <path
                d="M12.5 18C12.5 18 18.5 13.5811 18.5 12C18.5 10.4188 12.5 6 12.5 6"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
              <path
                d="M5.50005 18C5.50005 18 11.5 13.5811 11.5 12C11.5 10.4188 5.5 6 5.5 6"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </svg>
          </a>
        ) : (
          <span class="join-item btn btn-sm btn-disabled" aria-label="Last page">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none">
              <path
                d="M12.5 18C12.5 18 18.5 13.5811 18.5 12C18.5 10.4188 12.5 6 12.5 6"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
              <path
                d="M5.50005 18C5.50005 18 11.5 13.5811 11.5 12C11.5 10.4188 5.5 6 5.5 6"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </svg>
          </span>
        )}
      </nav>
    </section>
  )
}
