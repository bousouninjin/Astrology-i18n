---
import OptimizedPicture from '@/features/OptimizedPicture.astro';
import SkeletonCardHorizontal from '@/ui/SkeletonCardHorizontal.astro';
import Divider from '@/ui/Divider.astro';
import { formatDate } from '@/utils/date';
import type { Lang } from '@/utils/i18n';
import { categoryLabel, tagLabel } from '@/utils/translations';

interface Props {
  href?: string;
  imageSrc: any;
  imageAlt: string;
  title: string;
  description?: string;
  date?: string | Date;
  tags?: string[];
  lang?: Lang;

  priority?: boolean;
  variant?: 'default' | 'headline';
  class?: string;
  loading?: boolean;
}

const {
  href,
  imageSrc,
  imageAlt,
  title,
  description,
  date,
  tags = [],
  lang = 'zh',
  priority = false,
  variant = 'default',
  class: className,
  loading = false,
} = Astro.props as Props;

const Container = href ? 'a' : 'div';
const containerAttrs = href ? { href } : {};
const isHeadline = variant === 'headline';
const containerClass = [
  'group relative isolate flex gap-4',
  isHeadline ? 'flex-col-reverse md:flex-col' : 'flex-col md:flex-row',
  className ?? '',
]
  .filter(Boolean)
  .join(' ');
const imageClass = isHeadline ? 'w-full' : 'w-full md:w-2/3';
const contentClass = isHeadline ? 'flex w-full flex-col gap-2' : 'flex w-full flex-col gap-2 md:w-1/3';
const descriptionClass = isHeadline
  ? 'text-base text-base-content/90'
  : 'text-sm text-base-content/80';
const metaClass = isHeadline ? 'mt-2' : 'mt-auto';
---

{
  loading ? (
    <SkeletonCardHorizontal class={className} />
  ) : (
    <Container
      {...containerAttrs}
      class={containerClass}
    >
      <div class={imageClass}>
        <div class="aspect-video overflow-hidden rounded-md">
          <OptimizedPicture
            src={imageSrc}
            alt={imageAlt}
            class="h-full w-full object-cover transition-transform duration-300 ease-out group-hover:scale-[1.02]"
            fit="cover"
            position="center"
            priority={priority}
            sizes="(max-width: 1024px) 100vw, 760px"
          />
        </div>
      </div>
      <div class={contentClass}>
        <h3
          class="text-[15px] font-sans font-normal leading-[1.15] lg:group-hover:underline underline-offset-2"
          style="display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;"
        >
          {title}
        </h3>
        {description && (
          <p
            class={descriptionClass}
            style="display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;"
          >
            {description}
          </p>
        )}
        <div class={`${metaClass} flex flex-wrap items-center gap-x-2 gap-y-1 text-xs text-base-content/80`.trim()}>
          {tags?.map((tag) => <span class="text-primary dark:text-secondary">#{tagLabel(lang, tag)}</span>)}
          {tags?.length > 0 && date && <Divider />}
          <span>{date ? formatDate(date, lang) : ''}</span>
        </div>
      </div>
    </Container>
  )
}
