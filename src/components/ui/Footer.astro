---
import type { Lang } from '@/utils/i18n';
import { t } from '@/utils/translations';
import FooterNav from '@/ui/FooterNav.astro';
import { Icon } from 'astro-icon/components';
import { getRelativeLocaleUrl } from 'astro:i18n';
import Github from '@/assets/github.svg';

interface Props {
  lang?: Lang;
  githubUrl?: string;
  rssUrl?: string;
}

const resolvedLang = ((Astro.currentLocale as Lang | undefined) ??
  (Astro.props.lang as Lang | undefined) ??
  'zh') as Lang;

const siteName = t(resolvedLang, 'site.name');

const twitterHandleRaw = t(resolvedLang, 'site.twitter.site') || '';
const twitterHandle = String(twitterHandleRaw).replace(/^@/, '');
const xUrl = twitterHandle ? `https://x.com/${twitterHandle}` : 'https://x.com';
const githubUrl: string =
  (Astro.props.githubUrl as string | undefined) ?? 'https://github.com/idimilabs';

const rssUrl: string =
  (Astro.props.rssUrl as string | undefined) ?? getRelativeLocaleUrl(resolvedLang, '/rss.xml');
---

<footer class="footer border-t border-base-300 py-6">
  <div class="container">
    <div class="flex flex-col gap-4">
      <aside class="flex flex-col items-start gap-1">
        <a href={getRelativeLocaleUrl(resolvedLang, '/')} class="text-lg font-semibold">
          {siteName}
        </a>
        <p class="text-sm text-base-content/80">{t(resolvedLang, 'site.description')}</p>
      </aside>
      <FooterNav lang={resolvedLang} />
    </div>

    <div class="divider w-full h-1" />

    <div class="flex flex-col gap-4">
      <nav>
        <div class="flex items-center gap-3 text-sm">
          <ul class="flex flex-wrap gap-3">
            <li>
              <a
                href={xUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="link link-hover"
                aria-label="X"
              >
                <Icon name="lucide:twitter" class="h-5 w-5" />
              </a>
            </li>
            <li>
              <a
                href={githubUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="link link-hover"
                aria-label="GitHub"
              >
                <Github class="h-5 w-5" />
              </a>
            </li>
            <li>
              <a href={rssUrl} class="link link-hover" aria-label="RSS">
                <Icon name="lucide:rss" class="h-5 w-5" />
              </a>
            </li>
          </ul>
        </div>
      </nav>
      <div class="text-xs text-base-content/60">
        &copy; {new Date().getFullYear()} {siteName}. {t(resolvedLang, 'footer.allRightsReserved')}
      </div>
    </div>
  </div>
</footer>
