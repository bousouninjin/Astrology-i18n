---
import MainLayout from '@/layouts/MainLayout.astro';
import BaseHeader from '@/ui/BaseHeader.astro';
import type { Lang } from '@/utils/i18n';

interface Props {
  lang?: Lang;
  title?: string;
  description?: string;
  keywords?: string | string[];
  image?: string;
  imageAlt?: string;
  canonical?: string;
  noindex?: boolean;
  centered?: boolean;
  showHeader?: boolean;
  mainClass?: string;
}

const {
  lang: langProp = 'zh',
  title,
  description,
  keywords,
  image,
  imageAlt,
  canonical,
  noindex,
  centered = true,
  showHeader = true,
  mainClass,
} = Astro.props as Props;
const resolvedLang = ((Astro.currentLocale as Lang | undefined) ??
  (langProp as Lang | undefined) ??
  'zh') as Lang;
const hasHeaderSlot = Astro.slots.has('header');
const headerProps = {
  lang: resolvedLang,
  ...(title ? { title } : {}),
  ...(description ? { description } : {}),
  ...(keywords ? { keywords } : {}),
  ...(image ? { image } : {}),
  ...(imageAlt ? { imageAlt } : {}),
  ...(canonical ? { canonical } : {}),
  ...(typeof noindex === 'boolean' ? { noindex } : {}),
};
---

<MainLayout lang={resolvedLang} mainClass={mainClass}>
  <BaseHeader {...headerProps} slot="head" />
  {
    showHeader && (title || description || hasHeaderSlot) && (
      <section class={`mb-6 md:mb-8 ${centered ? 'text-center' : 'text-left'}`}>
        {hasHeaderSlot ? (
          <slot name="header" />
        ) : (
          <div>
            {title && <h1 class="text-2xl font-semibold tracking-tight sm:text-3xl">{title}</h1>}
            {description && (
              <p class="mt-2 text-base-content/80">{description}</p>
            )}
          </div>
        )}
      </section>
    )
  }

  <slot />
</MainLayout>
