---
import Header from '@/ui/Header.astro';
import Footer from '@/ui/Footer.astro';
import GTMHead from '@/analytics/GTMHead.astro';
import GTMBody from '@/analytics/GTMBody.astro';
import type { Lang } from '@/utils/i18n';
import { ClientRouter } from 'astro:transitions';
import '../styles/global.css';
import '@fontsource/source-sans-pro/400.css';
import '@fontsource/source-sans-pro/600.css';
import '@fontsource/source-sans-pro/700.css';
import '@fontsource-variable/source-serif-4';

interface Props {
  lang?: Lang;
  mainClass?: string;
}

const { lang: langProp = 'zh', mainClass } = Astro.props as Props;
const resolvedLang = ((Astro.currentLocale as Lang | undefined) ??
  (langProp as Lang | undefined) ??
  'zh') as Lang;
const mainClassName = `container flex-1 ${mainClass ?? 'py-6 lg:py-8'}`.trim();
---

<!doctype html>
<html lang={resolvedLang} class="scroll-pt-16">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <slot name="head" />
    <GTMHead />
    <ClientRouter />
    <script src="../utils/page-init.ts"></script>
    <script src="../utils/image-fade-in.ts"></script>
  </head>
  <body class="bg-base-100 text-base-content">
    <div class="flex min-h-dvh flex-col">
      <Header lang={resolvedLang} />
      <main id="main" class={mainClassName}>
        <slot />
      </main>
      <Footer lang={resolvedLang} />
      <slot name="after" />
    </div>
    <GTMBody />
  </body>
</html>
