[phases.setup]
# 必须使用 nodejs_23 以满足 Astro 5 / Vite 7 / Tailwind 4 的环境要求
pkgs = ["nodejs_22", "npm"]

[phases.install]
# 安装项目依赖和 EdgeOne 全局工具
cmds = ["npm ci", "npm install -g edgeone"]

[phases.build]
# 步骤 1: 编译 Astro 静态文件到 /dist
# 步骤 2: 直接通过 CLI 上传到 EdgeOne
# 如果上传失败，构建会在这里直接中断并报错，方便排查
cmds = [
    "npm run build",
    "edgeone pages deploy ./dist -n $EDGEONE_PROJECT_NAME -t $EDGEONE_API_TOKEN --force"
]

[start]
# 构建成功后，启动监控脚本占位，确保 Dokploy 显示 Running
cmd = "node deploy-wrapper.cjs"